(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}})();var U={exports:{}},P={};Object.defineProperty(P,"__esModule",{value:!0});function g(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function Y(e){if(Array.isArray(e))return g(e)}function Z(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function N(e,r){if(e){if(typeof e=="string")return g(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return g(e,r)}}function ee(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function te(e){return Y(e)||Z(e)||N(e)||ee()}function re(e,r){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=N(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(u){throw u},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,s=!1,a;return{s:function(){t=t.call(e)},n:function(){var u=t.next();return o=u.done,u},e:function(u){s=!0,a=u},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(s)throw a}}}}function ne(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function ie(e,r){if(typeof e!="object"||e===null)return e;var t=e[Symbol.toPrimitive];if(t!==void 0){var n=t.call(e,r||"default");if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(e)}function D(e){var r=ie(e,"string");return typeof r=="symbol"?r:String(r)}function I(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,D(n.key),n)}}function oe(e,r,t){return r&&I(e.prototype,r),t&&I(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function se(e,r,t){return r=D(r),r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}var ue=function(){function e(){ne(this,e),se(this,"subscribers",new Set)}return oe(e,[{key:"onSubscribe",get:function(){return this._onSubscribe||(this._onSubscribe=new e),this._onSubscribe}},{key:"onUnsubscribe",get:function(){return this._onUnsubscribe||(this._onUnsubscribe=new e),this._onUnsubscribe}},{key:"subscribe",value:function(t){var n,i=this;return this.subscribers.add(t),(n=this._onSubscribe)===null||n===void 0||n.emit(t),function(){return i.unsubscribe(t)}}},{key:"unsubscribe",value:function(t){var n;this.subscribers.delete(t),(n=this._onUnsubscribe)===null||n===void 0||n.emit(t)}},{key:"clear",value:function(){if(this._onUnsubscribe){var t=re(this.subscribers),n;try{for(t.s();!(n=t.n()).done;){var i=n.value;this._onUnsubscribe.emit(i)}}catch(o){t.e(o)}finally{t.f()}}this.subscribers.clear()}},{key:"emit",value:function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];this.subscribers.forEach(function(o){return o.apply(void 0,n)})}},{key:"emitAsync",value:function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Promise.all(te(this.subscribers).map(function(o){return o.apply(void 0,n)}))}}]),e}();P.Event=ue;U.exports=P;var T=U.exports;function $(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function ae(e,r){if(e){if(typeof e=="string")return $(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return $(e,r)}}function ce(e,r){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=ae(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(u){throw u},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,s=!1,a;return{s:function(){t=t.call(e)},n:function(){var u=t.next();return o=u.done,u},e:function(u){s=!0,a=u},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(s)throw a}}}}function fe(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function le(e,r){if(typeof e!="object"||e===null)return e;var t=e[Symbol.toPrimitive];if(t!==void 0){var n=t.call(e,r||"default");if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(e)}function H(e){var r=le(e,"string");return typeof r=="symbol"?r:String(r)}function k(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,H(n.key),n)}}function he(e,r,t){return r&&k(e.prototype,r),t&&k(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function p(e,r,t){return r=H(r),r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}var z;z=Symbol.iterator;var W=function(){function e(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];fe(this,e),p(this,"_version",0),p(this,"onEntityAdded",new T.Event),p(this,"onEntityRemoved",new T.Event),p(this,"entityPositions",new Map),this._entities=r,this.add=this.add.bind(this),this.remove=this.remove.bind(this);for(var t=0;t<r.length;t++)this.entityPositions.set(r[t],t)}return he(e,[{key:"version",get:function(){return this._version}},{key:"entities",get:function(){return this._entities}},{key:z,value:function(){var t=this,n=this._entities.length,i={value:void 0,done:!1};return{next:function(){return i.value=t._entities[--n],i.done=n<0,i}}}},{key:"size",get:function(){return this.entities.length}},{key:"first",get:function(){return this.entities[0]}},{key:"has",value:function(t){return this.entityPositions.has(t)}},{key:"add",value:function(t){return t&&!this.has(t)&&(this.entities.push(t),this.entityPositions.set(t,this.entities.length-1),this._version++,this.onEntityAdded.emit(t)),t}},{key:"remove",value:function(t){if(this.has(t)){this.onEntityRemoved.emit(t);var n=this.entityPositions.get(t);this.entityPositions.delete(t);var i=this.entities[this.entities.length-1];i!==t&&(this.entities[n]=i,this.entityPositions.set(i,n)),this.entities.pop(),this._version++}return t}},{key:"clear",value:function(){var t=ce(this),n;try{for(t.s();!(n=t.n()).done;){var i=n.value;this.remove(i)}}catch(o){t.e(o)}finally{t.f()}}}]),e}(),C=new WeakMap,x=0,de=function(r){var t=C.get(r);return t!==void 0?t:(C.set(r,x),x++)};function ye(){var e=new Array;function r(i){e.push(i)}function t(){e.length=0}function n(){e.forEach(function(i){return i()}),t()}return r.clear=t,r.flush=n,r}function w(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function ve(e){if(Array.isArray(e))return w(e)}function me(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function L(e,r){if(e){if(typeof e=="string")return w(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return w(e,r)}}function be(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function d(e){return ve(e)||me(e)||L(e)||be()}function f(e){return f=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},f(e)}function pe(e,r){for(;!Object.prototype.hasOwnProperty.call(e,r)&&(e=f(e),e!==null););return e}function y(){return typeof Reflect<"u"&&Reflect.get?y=Reflect.get.bind():y=function(r,t,n){var i=pe(r,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(arguments.length<3?r:n):o.value}},y.apply(this,arguments)}function _(e,r){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=L(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(u){throw u},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,s=!1,a;return{s:function(){t=t.call(e)},n:function(){var u=t.next();return o=u.done,u},e:function(u){s=!0,a=u},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(s)throw a}}}}function ge(e,r){if(typeof e!="object"||e===null)return e;var t=e[Symbol.toPrimitive];if(t!==void 0){var n=t.call(e,r||"default");if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(e)}function K(e){var r=ge(e,"string");return typeof r=="symbol"?r:String(r)}function l(e,r,t){return r=K(r),r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function M(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function c(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?M(Object(t),!0).forEach(function(n){l(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):M(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function B(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function q(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,K(n.key),n)}}function F(e,r,t){return r&&q(e.prototype,r),t&&q(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function h(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function S(e,r){return S=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},S(e,r)}function Q(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),r&&S(e,r)}function we(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function _e(e,r){if(r&&(typeof r=="object"||typeof r=="function"))return r;if(r!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return h(e)}function G(e){var r=we();return function(){var n=f(e),i;if(r){var o=f(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return _e(this,i)}}var J,Se=function(e){Q(t,e);var r=G(t);function t(){var n,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return B(this,t),n=r.call(this,i),l(h(n),"queries",new Set),l(h(n),"entityToId",new Map),l(h(n),"idToEntity",new Map),l(h(n),"nextId",0),n.onEntityAdded.subscribe(function(o){n.reindex(o)}),n.onEntityRemoved.subscribe(function(o){if(n.queries.forEach(function(a){return a.remove(o)}),n.entityToId.has(o)){var s=n.entityToId.get(o);n.idToEntity.delete(s),n.entityToId.delete(o)}}),n}return F(t,[{key:"update",value:function(n){function i(o,s,a){return n.apply(this,arguments)}return i.toString=function(){return n.toString()},i}(function(n,i,o){if(typeof i=="function"){var s=i(n);s&&Object.assign(n,s)}else typeof i=="string"?n[i]=o:i&&Object.assign(n,i);return this.reindex(n),n})},{key:"addComponent",value:function(i,o,s){i[o]===void 0&&(i[o]=s,this.reindex(i))}},{key:"removeComponent",value:function(i,o){if(i[o]!==void 0){if(this.has(i)){var s=c({},i);delete s[o],this.reindex(i,s)}delete i[o]}}},{key:"query",value:function(i){var o=Ae(i),s=V(o),a=_(this.queries),u;try{for(a.s();!(u=a.n()).done;){var b=u.value;if(b.key===s)return b}}catch(X){a.e(X)}finally{a.f()}var j=new Oe(this,o);return this.queries.add(j),j}},{key:"with",value:function(){for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return this.query({with:o,without:[],predicates:[]})}},{key:"without",value:function(){for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return this.query({with:[],without:o,predicates:[]})}},{key:"where",value:function(i){return this.query({with:[],without:[],predicates:[i]})}},{key:"reindex",value:function(i){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:i;if(this.has(i)){var s=_(this.queries),a;try{for(s.s();!(a=s.n()).done;){var u=a.value;u.evaluate(i,o)}}catch(b){s.e(b)}finally{s.f()}}}},{key:"id",value:function(i){if(this.has(i)){if(!this.entityToId.has(i)){var o=this.nextId++;this.entityToId.set(i,o),this.idToEntity.set(o,i)}return this.entityToId.get(i)}}},{key:"entity",value:function(i){return this.idToEntity.get(i)}}]),t}(W);J=Symbol.iterator;var Oe=function(e){Q(t,e);var r=G(t);function t(n,i){var o;return B(this,t),o=r.call(this),l(h(o),"_isConnected",!1),o.world=n,o.config=i,o.key=V(i),o.onEntityAdded.onSubscribe.subscribe(function(){return o.connect()}),o.onEntityRemoved.onSubscribe.subscribe(function(){return o.connect()}),o}return F(t,[{key:"isConnected",get:function(){return this._isConnected}},{key:"entities",get:function(){return this._isConnected||this.connect(),y(f(t.prototype),"entities",this)}},{key:J,value:function(){return this._isConnected||this.connect(),y(f(t.prototype),Symbol.iterator,this).call(this)}},{key:"connect",value:function(){if(!this._isConnected){this._isConnected=!0;var i=_(this.world),o;try{for(i.s();!(o=i.n()).done;){var s=o.value;this.evaluate(s)}}catch(a){i.e(a)}finally{i.f()}}return this}},{key:"disconnect",value:function(){return this._isConnected=!1,this}},{key:"with",value:function(){for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return this.world.query(c(c({},this.config),{},{with:[].concat(d(this.config.with),o)}))}},{key:"without",value:function(){for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return this.world.query(c(c({},this.config),{},{without:[].concat(d(this.config.without),o)}))}},{key:"where",value:function(i){return this.world.query(c(c({},this.config),{},{predicates:[].concat(d(this.config.predicates),[i])}))}},{key:"want",value:function(i){return this.config.with.every(function(o){return i[o]!==void 0})&&this.config.without.every(function(o){return i[o]===void 0})&&this.config.predicates.every(function(o){return o(i)})}},{key:"evaluate",value:function(i){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:i;if(this.isConnected){var s=this.want(o),a=this.has(i);s&&!a?this.add(i):!s&&a&&this.remove(i)}}}]),t}(W),R=function(r){return d(new Set(r.sort().filter(function(t){return!!t&&t!==""})))};function Pe(e){return d(new Set(e))}function Ae(e){return{with:R(e.with),without:R(e.without),predicates:Pe(e.predicates)}}function V(e){return"".concat(e.with.join(","),":").concat(e.without.join(","),":").concat(e.predicates.map(function(r){return de(r)}).join(","))}ye();function Ee(){const e=new Se;return e.createEntity=function(r={}){return this.add(r)},e.removeEntity=function(r){return this.remove(r)},e.systems=[],e.registerSystem=function(r,t=0){return r.priority=t,r.world=this,this.systems.push(r),this.systems.sort((n,i)=>n.priority-i.priority),r},e.update=function(r){for(const t of this.systems)t.enabled&&t.update(r)},e}class A{constructor(){this.priority=0,this.world=null,this.enabled=!0}update(r){}enable(){return this.enabled=!0,this}disable(){return this.enabled=!1,this}}class je extends A{constructor(){super(),this.socket=null,this.connected=!1,this.reconnecting=!1,this.serverUrl=null,this.clientId=null,this.pendingMessages=[],this.messageHandlers={}}connect(r){const t=window.location.protocol==="https:"?"wss:":"ws:",n=window.location.host;this.serverUrl=r||`${t}//${n}/ws`,console.log(`Connecting to server at ${this.serverUrl}`),this.socket=new WebSocket(this.serverUrl),this.socket.onopen=this.handleConnect.bind(this),this.socket.onclose=this.handleDisconnect.bind(this),this.socket.onerror=this.handleError.bind(this),this.socket.onmessage=this.handleMessage.bind(this)}handleConnect(){for(console.log("Connected to server"),this.connected=!0;this.pendingMessages.length>0;){const r=this.pendingMessages.shift();this.sendMessage(r.type,r.data)}this.sendMessage("join",{clientId:this.clientId})}handleDisconnect(r){console.log(`Disconnected from server: ${r.code} ${r.reason}`),this.connected=!1,this.reconnecting||(this.reconnecting=!0,setTimeout(()=>{this.reconnecting=!1,this.connect(this.serverUrl)},3e3))}handleError(r){console.error("WebSocket error:",r)}handleMessage(r){try{const t=JSON.parse(r.data);t.type&&this.messageHandlers[t.type]?this.messageHandlers[t.type](t.data):console.warn("Unknown message type:",t.type)}catch(t){console.error("Error parsing message:",t)}}sendMessage(r,t){const n=JSON.stringify({type:r,data:t});this.connected&&this.socket.readyState===WebSocket.OPEN?this.socket.send(n):this.pendingMessages.push({type:r,data:t})}registerHandler(r,t){this.messageHandlers[r]=t}sendInput(r,t){this.sendMessage("input",{sequence:t,input:r})}update(r){const t=this.world.with("network");for(const n of t)n.network.isOwned}}class Ie extends A{constructor(){super()}init(){}}class Te extends A{constructor(){super()}init(){}}const v=Ee();let O=0,m=!1;function E(e){if(!m)return;const r=e||performance.now(),t=(r-O)/1e3;O=r,v.update(t),requestAnimationFrame(E)}function $e(){console.log("Initializing Venture & Valor...");const e=v.registerSystem(new je,0),r=v.registerSystem(new Ie,10),t=v.registerSystem(new Te,5);e.connect(),r.init(),t.init(),m=!0,O=performance.now(),requestAnimationFrame(E),console.log("Game initialized")}window.addEventListener("DOMContentLoaded",$e);window.Game={world:v,start:()=>{m=!0,requestAnimationFrame(E)},stop:()=>{m=!1},isRunning:()=>m};
